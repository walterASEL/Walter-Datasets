---
title: "1.4 Transformations between coordinate systems"
author: "Manual of Applied Spatial Ecology"
date: "3/11/2022"
output:
  pdf_document: default
  html_document: default
  word_document: default
---
Transformations in ArcMap can be the most troublesome component of spatial analysis that is often overlooked as the reason for errors in data analysis. We will briefly go into the 2 most common problems requiring our assistance from collaborators and potential solutions.

1. What coordinate system were the data collected in?

It seems that every GPS collar, handheld GPS unit, GIS landcover layer, etc. has been created using a different coordinate system and it's not the one you have at your study site. Or perhaps NAD 1927 was used and you decided to be modern and want to use NAD 1983. Regardless, the coordinate systems must match even though ArcMap often overlays them with "on the fly projections". The "on the fly" component of ArcMap is great for visualization but not for spatial ecologists that need data analysis. We often can determine which coordinate system the data were created in using the metadata to define a coordinate system or project the data into a coordinate system for data analysis.

2. A Toolbox in ArcMap may not extract data or clip data properly

As mentioned previously, data collected with a GPS collar or handheld GPS may not be in the same geographic or projected coordinate system as the GIS layers you download or receive from collaborators (i.e., Digital Elevation Data, National Land Cover Data). As you attempt to use a Toolbox function, such as clipping National Land Cover Data within the extent of your GPS locations, an error may result.

We will now explore some transformations of data in R to help understand what Projections and Transformations are all about. The dataset that follows is for a project in Colorado with mule deer equipped with GPS collars that collected locations every 3 hours. The purpose of the study was to determine mule deer use of agricultural crops, sunflowers in this case, in response to years of damage complaints from farmers. We will use this subset of dataset in later exercises as well.

1\. Exercise 1.4 - Download and extract zip folder into your preferred location

2\. Set working directory to the extracted folder in R under Session - Set Working Directory...

3\. Now open the script "MDprojections.R" and run code directly from the script

```{r}
setwd("WalterRprojects/Walter-Datasets/Exercise_1.4_Projections")
```


4\. First we need to load the packages needed for the exercise
```{r warning=FALSE, message=FALSE}
library(rgdal)
```
5\. Now let's have a separate section of code to include projection information we will use throughout the exercise. In previous versions, these lines of code were within each block of code
```{r}
crs<-"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
new.crs <-CRS("+proj=utm +zone=12 +datum=WGS84")
```
6\. Read in some shapefiles of the study area
```{r}
study.states<-readOGR(dsn=".",layer="MDcounties",verbose=FALSE)
plot(study.states, col="grey")

#Let's zoom into the region we have locations instead of county level
study.zoom<-readOGR(dsn=".",layer="MDzoom", verbose=FALSE)
plot(study.zoom, col="grey")
```
\newline
7\. Import the csv file that contains all the mule deer locations by ID
```{r}
muleys <-read.csv("muleysexample.csv", header=T)
```
8\. Create a spatial data frame of raw mule deer locations with projection defined similar to study site shapefile (i.e., WGS84)
```{r}
coords<-data.frame(x = muleys$Long, y = muleys$Lat)
plot(coords)
```
9\. Remove outlier locations
```{r}
newmuleys <-subset(muleys, muleys$Long > -110.50 & muleys$Lat > 37.3 
   & muleys$Long < -107)
muleys <- newmuleys
```
10\. Create a new spatial data frame of mule deer locations with outliers removed and projection defined similar to study site shapefile (i.e., WGS84)
```{r eval=FALSE}
coords<-data.frame(x = muleys$Long, y = muleys$Lat)
plot(coords)
```
11\. Create a spatial points data frame of mule deer locations with projection defined similar to study site shapefile (i.e., WGS84)
```{r eval=FALSE}
deer.spdf <- SpatialPointsDataFrame(coords= coords, data = muleys, proj4string = CRS(crs))
coordinates(deer.spdf)[1:5,]
class(deer.spdf)
proj4string(deer.spdf)
plot(deer.spdf)
points(deer.spdf, col="yellow")
```
12\. Now let's project both the mule deer locations and study site shapefile to NAD83 UTM Zone 12 (Fig. 1.4, 1.5)
```{r eval=FALSE}
MDzoomUTM12 <-spTransform(study.zoom, CRS=new.crs)
plot(MDzoomUTM12, col="bisque")
class(MDzoomUTM12)
proj4string(MDzoomUTM12)

#projection for mule deer locations
deerUTM12 <-spTransform(deer.spdf, CRS=new.crs)
points(deerUTM12, col="red")
class(deerUTM12)
proj4string(deerUTM12)

#See new projected coordinates in UTM 12N for the first 5 locations compared to similar line of code above in latitude/longitude
coordinates(deerUTM12)[1:5,]
```

